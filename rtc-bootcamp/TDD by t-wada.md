# TDD

webDB press 102？にペアプロが再興した理由をかいてる

味噌はミニマムの自分のテスト開発環境が一つあると良ささそう。（環境を持っている）。和田さんのいつものテストスタックは？



## TDDとは何か

- スキルの領域、量をこなすことで身につけるもの
- 自習でやってTDDを身につける(TDD本よいよ)
- TDDは旧来のソフトエンジニア工学（設計してから実装する）とは反する。汚いけど動くコードをまづつくり、きれいにしていいくがTDDのやり方
- ソフトと建築の違いは、要素の再現可能性だ。ソフトはOSも変わるし、どんどん変わる。使いまわせない。
- ソフトは書いてみるまでわからない

TDDのやり方にも府の要素ある

- 怠惰：動くから良くね
- 焦り：スケジュールなどのプレッシャーによる焦り
- **恐れ：汚いけどうごいた。きれいにしていくうちに動かなくなったらどうしよう**

そこでTDD

## TDDサイクル

RED GREEN REFACTOR

- REDからGREENまでは愚直な実装で桶
- TDDにおけるリファクタリングは「テストが動きながらコードをきれいにしていく」
- リファクタリングのやめ時はふわっとしている。何らかの重複が除去されたら終了などがよくある終了フラグ

TDDで恐れは克服できた。焦りは？

- 短期的な価値によりきりがち。リファクタリングは来週やリます的な
- 中長期的な価値は見えづらい
- リファクタリングは先延ばしになりがち
- 掃除見たく、毎週少しづつやればすぐ終わるが、先のばしにすると大掃除になって大きなタスクとなる。
 
**リファクタリングは独立（一つのタスクにするとか）してはだめ。弱いから。リファクタリングはプログラミングのステップに混ぜる。これがTDDのリファクタリングだ**

## TDDの粒度

- 基本的にTDDはスケールフリー。
- 主にはUnitTestで。
- その外側には、受け入れテスト
- 更に外側には頻繁なリリースのフィードバックループがある

## ライブコーディング

TDDサイクルの一周目はやること多い。TODO作ったり、環境つくったりするから。なので一周目は小さく。

テストコードは何をしたいのか。何をしているのかが明らかである必要がある。

### 1. TODOリストを作る

- 項目を分ける
- テストし易い形にならべる
- コアロジックはより細かく分類

### 2. テスト環境を構築

- npmで入れたり
- 最近、テストと対象ファイルが1:1になるのでTestをprefixでつけるのはやり。一つのテストファイルの中で複数環境準備できるようになったから


### 3. まず失敗させる

- テストはドキュメントとしての役割がなければならない。動作を正確に表す
- 視認性が大事。日本語で書くとかあり。
- なれるまでは、**ゴールから順に書いていく**。アサーション書いて実行コード書いて、前準備コード書く。**これ大事**。ゴールが明確なので考えがシャープになる
- 'actual'はテストの世界で実際の期待値を表す変数。関数の返り値。よく使えそう。
- 利用者側の視点（使う側）からコードをかくのがポイント。こんなメソッドがほしいなとか。
- 名前とかテスト名とか考えるので一周目は大変

### 4. テストをまず通す(return 1)とかしてもいいから

- **テストコードにバグがないのをかくにんするため**
- フェイクイットという技法でテストコードのテストを書く方法がある。
- **テストコードのテストコードは実装コードである**

### 5. リファクタリング

　
- bad: アサーションルーレット
    - テスト読んだときに何をしているのかわかりにくい
    - どこで落ちたのかわからない
- 1test, 1assertionによってかいけつする
- コードの重複はリファクタリングで解決する.2out3outどちらも状況によって使い分けよう
- 
### 3.2. まず失敗させる

- 簡単なものに細かくして書く
- テストフレームワークは実行順普通は散らす。なぜなら、テスト間依存をなくすため
- テスト一件書いて、予想通りテスト落としてそしてコード書いてテストとおしてグリーンいく（明白なテスト）。だんだんこれになっていく。

## 3つのモード

- 値を当てる -> 仮実装 -> 本実装　三角測量
- 仮実装 -> 本実装
- 本実装: 明白なテスト

### テストコードは動く仕様書でなければならない

bad -> テストケースから具体的な振る舞いはわかるが仕様が伝わらない。

テスト名をより仕様を会え合わしたものにする。

#### テスト構造の構造化を用いる

**階層化の機能を用いて、仕様レベルの階層と具体例のレベルに分けてやってテストを書く** これ大事。

こんな感じの階層になると、テスト名から仕様がわかるようになる！！！

- testClass
    - method
        - methodの仕様
            - 仕様の具体例

そのときに、階層ツリー構造は対称性があるべき。なんらかの意図を表すべき。コードだからね。

### テストコードのスタイル

どこまでテストコード書く?

テストをどうプロジェクトで捉えるかが大事。

テストを開発のカンフル剤としてとらえ、メンテナンスコストを考えるなら最低限のテストを書く。

減らせる根拠と度胸は書いた本人しかわからん、テストコードはメンテなブルでなければならない。

**テストのコードを必要十分まで減らす必要がある。テストコードはメンテナンスコストをはらむものだ。なので減らす必要性もある**


- 問題をテスト可能な状態に小さく分割する
- **歩幅を調整する**
    - テスト　ー＞　仮実装　ー＞三角測量ー＞実装
    - テスト　ー＞　仮実装
    - テスト　ー＞　明白な実装
- テストの構造とリファクタリング

歩幅はギアなので、自分のコンディションに応じて変えていくことが大切。