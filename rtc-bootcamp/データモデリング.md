# データモデリング

## データモデリングとは

### データと情報

歴史的事実と歴史の関係。

#### データ

データは事実を表す。データそれ自体新見はなく記録として残しておくもの。

#### 情報

情報は**データ**を選択加工して当事者が必要とする知識を取り出したもの。

**ほしいのは情報！そのためにデータが必要！**

**必要な情報は時と場合によって異なる。**なので**事実をそのまま事実として記録することが大切。**

### データベースとファイル

データべースは個別のプログラムアクセスとは独立して存在する。**多目的、無目的**

ファイルは個別のプログラムのアクセスを前提に存在する。

### システム構築の流れ

#### プロセス中心アプローチ（従来型。NoSQL的な）

ある問題解決を最適化する仕組みとして**設計**する

#### データモデリングアプローチ（こちらがベター。RDB）

データを**表現**する。

システムをデータ貯蔵器（RDB）とし情報生成器（SQL）とする。

#### 論理ERDの役割とメリット

- システムの一望できる
- 図によって共通認識が得られる

#### 従来のプロセス中心システム構築の考え方

出力から様々な属性を集めるような手順を踏む

異音同義、同音異義などがあるのでうまくそれを一つの事実として落とし込む必要がある。具体的にはシステムのユーザー属性に応じて同じデータの名前が違ったりする。

アンチ例として、出力画面そのままの属性を持つテーブルを作っちゃったりする。そうすると他のテーブルと属性が論理的にかぶってしまい更新処理が必要になるなどの不都合が生じる。

問題解決の課題のみを追求するあまり、課題街に潜む本質的に重要な考慮点を見落とす危険がある。

#### データモデリングアプローチ

ボトムアップ的。

- 異音同義ドメインをまとめる
- SQLによって情報にしていく
- データベースはリレーション（テーブル）の集まりとなる。リレーションの間にはリレーションシップがある。
- ドメインはいづれか一つのリレーションに集まり、複数のリレーションに収まることはない。
- **One　Fact in One Place**

## データモデリングの手順（Not　How to, But what to do）

### Entityを抽出する

**実世界のものごと（モノとコト＝Entity）とは**

#### コト（Event）

システム化対象領域で本業として**繰り返しなされる行為**。Event。
6W2Hを属性に持つ。Whenは必須。
How much を持つことが多く期間で集合演算される。
**システムはコトをデータとして逐一「記録」していく。**

**Whyって例えばどんなのでしょう？？？？**

- イベントのキャンセル理由とか

#### モノ（Resource）

**ある「期間」存在し「コト」に直接・間接に投入される資源。**Resource。
システム的には発生「時点」に登録し、消滅「時点」まで存在する
モノはある期間一定の属性値を持ちながら状態遷移をしていく。
時点を指定することにより、その時のものの属性値を得る
二律背反性（一過性VS反復性 チケットは一過性）

**イベントを先に捉えて、リソースを徐々に考えていくのがよい**

### Entityのキー属性を見つける

#### キー属性を探す

##### プライマリーキー（PK）

行を一意にするための
ないことはない
複合キー。２つの属性で一つのキーとなるもの。貸出明細など）
**複数が見つかる場合、それらを候補キーと呼び、一つを主キーとし、残りは代替キーとなる**

##### 代替キー（AK）

行を一意にするためのキー（プライマリーと同じ）

#### 主キーの持ち方には２つの方法がある

##### 自然キー

集合を構成する属性の中から行を識別する属性を見つけてキーとする

##### 代理キー

システムに絶対にダブらない連続番号を発生させ、それを代わりにキーとする

#### Entity間に関連をつける

- Relationshipは参照する相手のPKやFKを属性に取り込むこと。
- 取り込んだ相手側のキーをFK(Forgin key)とよぶ
- Entity間にRelashionshipを付けることにより、外部参照制約を付けることになる。（＝相手にない属性を取り込んじゃだめ）

##### 特殊な関係

###### 親と子

子が親のPKをPKとして持つ。親に依存。親がないと個は存在しない。
第一正規化（繰り返し排除）のため、その部分を独立させることにより生まれる

###### 交差関連

複数の他のEntityのPKを組み合わせた複合キーをPKとする
組み合わせ制約を表す。一方から見れば、他方は重複を許さない個を表す。

###### すーぱー・サブ関連

親が複数の属性構成が異なる子を持つ
子の間は、排他か共存可能化のどちらか

#### 正規化違反チェック

正規化＝＞ダブりなく分ける。冗長性がなくわける。

ダブリがないかチェックってこと。

##### 繰り返し属性の排除（第一正規化）

Entityが持つ属性は全て異ならなければならない。（第一正規化違反）
別のEntity（ドメイン）として切り出す

##### 関数従属性に関する正規化違反

非キー属性の中に、複合キーの一部にだけ従属するキーがある（第二正規化違反）
別のドメインに切り出す。

ボイコッド世紀系違反

##### 

データを集合ととらえ、関連で結びつけ、ER図をアウトプットする。

お金関係の重要な情報を含むイベントは、単品料理に含んでいても明細イベントできんがくをもつ

事実のみを集めて

関係性を表すFKの"null"は、あり。関係がないという意味を表す。

売上値段とカタログ価格が違うこともある。値引きとかクーポンとか。なので、冗長ではあるが事実としてしっかりと残すという選択肢は十分ありえる。お金とかある。

日付と時刻を分けるとかある。深夜営業のときとか、日付